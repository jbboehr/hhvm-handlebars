language: php

php:
  - hhvm

before_install:
  - sudo apt-get update -qq
  - sudo apt-get install software-properties-common || sudo apt-get install python-software-properties || true
  - sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test
  - sudo apt-add-repository -y ppa:jbboehr/ppa
  - sudo apt-add-repository -y ppa:jbboehr/handlebars
  - sudo apt-add-repository -y ppa:mandel/movie-tracker
  - sudo apt-get update -qq
  - sudo apt-get install -qq libhandlebars-dev libtalloc-dev hhvm hhvm-dev g++-4.8 gcc-4.8 libboost1.49-dev libgoogle-glog-dev libjemalloc-dev
  - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.8 20
  - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.8 20
  - sudo update-alternatives --config gcc
  - sudo update-alternatives --config g++
  - export CXX=`which g++-4.8`
  - export CC=`which gcc-4.8`

script:
  - hphpize
  - cmake .
  - make
  - php generate-tests.php
  - ./test

branches:
  only:
    - master
    - travisci-changes

